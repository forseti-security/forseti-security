---
layout: docs

title: "google.cloud.forseti.services.model.importer.importer"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.services.model.importer.importer</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2017 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;Importer implementations.&quot;&quot;&quot;</span>

<span class="c1"># pylint: disable=too-many-instance-attributes</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="k">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="k">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.inventory.storage</span> <span class="k">import</span> <span class="n">Storage</span> <span class="k">as</span> <span class="n">Inventory</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.utils</span> <span class="k">import</span> <span class="n">get_resource_id_from_type_name</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.utils</span> <span class="k">import</span> <span class="n">get_sql_dialect</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.utils</span> <span class="k">import</span> <span class="n">to_full_resource_name</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.utils</span> <span class="k">import</span> <span class="n">to_type_name</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="ResourceCache"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.ResourceCache">[docs]</a><span class="k">class</span> <span class="nc">ResourceCache</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Resource cache.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResourceCache.__setitem__"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.ResourceCache.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overriding to assert the keys does not exist previously.</span>

<span class="sd">            Args:</span>
<span class="sd">                key (object): Key into the dict.</span>
<span class="sd">                value (object): Value to set.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception: If the key already exists in the dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Key should not exist: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResourceCache</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="EmptyImporter"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.EmptyImporter">[docs]</a><span class="k">class</span> <span class="nc">EmptyImporter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Imports an empty model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">readonly_session</span><span class="p">,</span>
                 <span class="n">model</span><span class="p">,</span> <span class="n">dao</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an EmptyImporter which creates an empty stub model.</span>

<span class="sd">        Args:</span>
<span class="sd">            session (object): Database session.</span>
<span class="sd">            readonly_session (Session): Database session (read-only).</span>
<span class="sd">            model (str): Model name to create.</span>
<span class="sd">            dao (object): Data Access Object from dao.py.</span>
<span class="sd">            _ (object): Unused.</span>
<span class="sd">            *args (list): Unused.</span>
<span class="sd">            **kwargs (dict): Unused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>  <span class="c1"># Unused.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readonly_session</span> <span class="o">=</span> <span class="n">readonly_session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dao</span> <span class="o">=</span> <span class="n">dao</span>

<div class="viewcode-block" id="EmptyImporter.run"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.EmptyImporter.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the import.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_description</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;empty&#39;</span><span class="p">,</span> <span class="s1">&#39;pristine&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_done</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="InventoryImporter"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter">[docs]</a><span class="k">class</span> <span class="nc">InventoryImporter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Imports data from Inventory.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">session</span><span class="p">,</span>
                 <span class="n">readonly_session</span><span class="p">,</span>
                 <span class="n">model</span><span class="p">,</span>
                 <span class="n">dao</span><span class="p">,</span>
                 <span class="n">service_config</span><span class="p">,</span>
                 <span class="n">inventory_index_id</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a Inventory importer which creates a model from the inventory.</span>

<span class="sd">        Args:</span>
<span class="sd">            session (Session): Database session.</span>
<span class="sd">            readonly_session (Session): Database session (read-only).</span>
<span class="sd">            model (Model): Model object.</span>
<span class="sd">            dao (object): Data Access Object from dao.py</span>
<span class="sd">            service_config (ServiceConfig): Service configuration.</span>
<span class="sd">            inventory_index_id (int64): Inventory id to import from</span>
<span class="sd">            *args (list): Unused.</span>
<span class="sd">            **kwargs (dict): Unused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>  <span class="c1"># Unused.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">readonly_session</span> <span class="o">=</span> <span class="n">readonly_session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dao</span> <span class="o">=</span> <span class="n">dao</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_config</span> <span class="o">=</span> <span class="n">service_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inventory_index_id</span> <span class="o">=</span> <span class="n">inventory_index_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">role_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permission_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_cache</span> <span class="o">=</span> <span class="n">ResourceCache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">membership_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">membership_map</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Maps group_name to {member_name}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">member_cache_policies</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">found_root</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># pylint: disable=too-many-statements</span>
<div class="viewcode-block" id="InventoryImporter.run"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the import.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the importer encounters an unknown</span>
<span class="sd">                inventory type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gcp_type_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;organization&#39;</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">,</span>
            <span class="s1">&#39;project&#39;</span><span class="p">,</span>
            <span class="s1">&#39;appengine_app&#39;</span><span class="p">,</span>
            <span class="s1">&#39;appengine_service&#39;</span><span class="p">,</span>
            <span class="s1">&#39;appengine_version&#39;</span><span class="p">,</span>
            <span class="s1">&#39;appengine_instance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;backendservice&#39;</span><span class="p">,</span>
            <span class="s1">&#39;billing_account&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bucket&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cloudsqlinstance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_autoscaler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_backendbucket&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_healthcheck&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_httphealthcheck&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_httpshealthcheck&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_license&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_project&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_router&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_sslcertificate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_targethttpproxy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_targethttpsproxy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_targetinstance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_targetpool&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_targetsslproxy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_targettcpproxy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compute_urlmap&#39;</span><span class="p">,</span>
            <span class="s1">&#39;crm_org_policy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dataset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;disk&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dns_managedzone&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dns_policy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;firewall&#39;</span><span class="p">,</span>
            <span class="s1">&#39;forwardingrule&#39;</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">,</span>
            <span class="s1">&#39;instance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;instancegroup&#39;</span><span class="p">,</span>
            <span class="s1">&#39;instancegroupmanager&#39;</span><span class="p">,</span>
            <span class="s1">&#39;instancetemplate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;kms_cryptokey&#39;</span><span class="p">,</span>
            <span class="s1">&#39;kms_cryptokeyversion&#39;</span><span class="p">,</span>
            <span class="s1">&#39;kms_keyring&#39;</span><span class="p">,</span>
            <span class="s1">&#39;kubernetes_cluster&#39;</span><span class="p">,</span>
            <span class="s1">&#39;lien&#39;</span><span class="p">,</span>
            <span class="s1">&#39;network&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pubsub_topic&#39;</span><span class="p">,</span>
            <span class="s1">&#39;serviceaccount&#39;</span><span class="p">,</span>
            <span class="s1">&#39;serviceaccount_key&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sink&#39;</span><span class="p">,</span>
            <span class="s1">&#39;snapshot&#39;</span><span class="p">,</span>
            <span class="s1">&#39;spanner_instance&#39;</span><span class="p">,</span>
            <span class="s1">&#39;spanner_database&#39;</span><span class="p">,</span>
            <span class="s1">&#39;subnetwork&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">gsuite_type_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;gsuite_group&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gsuite_user&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">member_type_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;gsuite_user_member&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gsuite_group_member&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">autocommit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">autocommit</span>
        <span class="n">autoflush</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">autoflush</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">autoflush</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">with</span> <span class="n">Inventory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readonly_session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inventory_index_id</span><span class="p">,</span>
                           <span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">inventory</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>
                <span class="n">description</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;inventory&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;source_info&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;inventory_index_id&#39;</span><span class="p">:</span> <span class="n">inventory</span><span class="o">.</span><span class="n">inventory_index</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
                    <span class="s1">&#39;source_root&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">(</span><span class="n">root</span><span class="p">),</span>
                    <span class="s1">&#39;pristine&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;gsuite_enabled&#39;</span><span class="p">:</span> <span class="n">inventory</span><span class="o">.</span><span class="n">type_exists</span><span class="p">(</span>
                        <span class="p">[</span><span class="s1">&#39;gsuite_group&#39;</span><span class="p">,</span> <span class="s1">&#39;gsuite_user&#39;</span><span class="p">])</span>
                <span class="p">}</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Model description: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_description</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">description</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">]:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Root resource is organization: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Root resource is not organization: </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

                <span class="n">item_counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Start storing resources into models.&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">gcp_type_list</span><span class="p">):</span>
                    <span class="n">item_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_store_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">item_counter</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">:</span>
                        <span class="c1"># Flush database every 1000 resources</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Flushing model write session: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                                     <span class="n">item_counter</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">item_counter</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="c1"># Additional rows added since last flush.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Finished storing resources into models.&#39;</span><span class="p">)</span>

                <span class="n">item_counter</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_action_wrapper</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">([</span><span class="s1">&#39;role&#39;</span><span class="p">]),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_role</span><span class="p">,</span>
                    <span class="n">post_action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_role_post</span>
                <span class="p">)</span>

                <span class="n">item_counter</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_action_wrapper</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">gcp_type_list</span><span class="p">,</span>
                                   <span class="n">fetch_dataset_policy</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dataset_policy</span>
                <span class="p">)</span>

                <span class="n">item_counter</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_action_wrapper</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">gcp_type_list</span><span class="p">,</span>
                                   <span class="n">fetch_service_config</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_service_config</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">model_action_wrapper</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">gsuite_type_list</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_store_gsuite_principal</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">model_action_wrapper</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">gcp_type_list</span><span class="p">,</span> <span class="n">fetch_enabled_apis</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_enabled_apis</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">model_action_wrapper</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">member_type_list</span><span class="p">,</span> <span class="n">with_parent</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_store_gsuite_membership</span><span class="p">,</span>
                    <span class="n">post_action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_store_gsuite_membership_post</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">denorm_group_in_group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">model_action_wrapper</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">inventory</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">gcp_type_list</span><span class="p">,</span>
                                   <span class="n">fetch_iam_policy</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_store_iam_policy</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Importer has an exception: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Set model status.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                <span class="n">inventory</span><span class="o">.</span><span class="n">inventory_index</span><span class="o">.</span><span class="n">inventory_index_warnings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_done</span><span class="p">(</span><span class="n">item_counter</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Finished running importer.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="n">autocommit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">autoflush</span> <span class="o">=</span> <span class="n">autoflush</span></div>
    <span class="c1"># pylint: enable=too-many-statements</span>

<div class="viewcode-block" id="InventoryImporter.model_action_wrapper"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter.model_action_wrapper">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">model_action_wrapper</span><span class="p">(</span><span class="n">session</span><span class="p">,</span>
                             <span class="n">inventory_iterable</span><span class="p">,</span>
                             <span class="n">action</span><span class="p">,</span>
                             <span class="n">post_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">flush_count</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model action wrapper. This is used to reduce code duplication.</span>

<span class="sd">        Args:</span>
<span class="sd">            session (Session): Database session.</span>
<span class="sd">            inventory_iterable (Iterable): Inventory iterable.</span>
<span class="sd">            action (func): Action taken during the iteration of</span>
<span class="sd">                the inventory list.</span>
<span class="sd">            post_action (func): Action taken after iterating the</span>
<span class="sd">                inventory list.</span>
<span class="sd">            flush_count (int): Flush every flush_count times.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Number of item iterated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Performing model action: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">inventory_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inventory_iterable</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inventory_data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">action</span><span class="p">(</span><span class="o">*</span><span class="n">inventory_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">action</span><span class="p">(</span><span class="n">inventory_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">idx</span> <span class="o">%</span> <span class="n">flush_count</span><span class="p">:</span>
                <span class="c1"># Flush database every flush_count resources</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Flushing write session: </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="n">flush_count</span><span class="p">:</span>
            <span class="c1"># Additional rows added since last flush.</span>
            <span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">post_action</span><span class="p">:</span>
            <span class="n">post_action</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="InventoryImporter._store_gsuite_principal"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._store_gsuite_principal">[docs]</a>    <span class="k">def</span> <span class="nf">_store_gsuite_principal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">principal</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store a gsuite principal such as a group, user or member.</span>

<span class="sd">        Args:</span>
<span class="sd">            principal (object): object to store.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: if the principal type is unknown.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">gsuite_type</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="n">get_resource_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">gsuite_type</span> <span class="o">==</span> <span class="s1">&#39;gsuite_user&#39;</span><span class="p">:</span>
            <span class="n">member</span> <span class="o">=</span> <span class="s1">&#39;user/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;primaryEmail&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">gsuite_type</span> <span class="o">==</span> <span class="s1">&#39;gsuite_group&#39;</span><span class="p">:</span>
            <span class="n">member</span> <span class="o">=</span> <span class="s1">&#39;group/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown gsuite principal: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gsuite_type</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">member</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">:</span>
            <span class="n">m_type</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_MEMBER</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">member</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">m_type</span><span class="p">,</span>
                <span class="n">member_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">[</span><span class="n">member</span><span class="p">])</span></div>

<div class="viewcode-block" id="InventoryImporter._store_gsuite_membership_post"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._store_gsuite_membership_post">[docs]</a>    <span class="k">def</span> <span class="nf">_store_gsuite_membership_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Flush storing gsuite memberships.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># session.execute automatically flushes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">membership_items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_sql_dialect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">:</span>
                <span class="c1"># SQLite doesn&#39;t support bulk insert</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">membership_items</span><span class="p">:</span>
                    <span class="n">stmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_MEMBERSHIP</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_MEMBERSHIP</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">membership_items</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._store_gsuite_membership"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._store_gsuite_membership">[docs]</a>    <span class="k">def</span> <span class="nf">_store_gsuite_membership</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store a gsuite principal such as a group, user or member.</span>

<span class="sd">        Args:</span>
<span class="sd">            child (object): member item.</span>
<span class="sd">            parent (object): parent part of membership.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">member_name</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Create the type:name representation for a non-group.</span>

<span class="sd">            Args:</span>
<span class="sd">                child (object): member to create representation from.</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: type:name representation of the member.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get_resource_data</span><span class="p">()</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                                  <span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">group_name</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Create the type:name representation for a group.</span>

<span class="sd">            Args:</span>
<span class="sd">                parent (object): group to create representation from.</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: group:name representation of the group.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_resource_data</span><span class="p">()</span>
            <span class="k">return</span> <span class="s1">&#39;group/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="c1"># Gsuite group members don&#39;t have to be part</span>
        <span class="c1"># of this domain, so we might see them for</span>
        <span class="c1"># the first time here.</span>
        <span class="n">member</span> <span class="o">=</span> <span class="n">member_name</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">member</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">:</span>
            <span class="n">m_type</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_MEMBER</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">member</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">m_type</span><span class="p">,</span>
                <span class="n">member_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">[</span><span class="n">member</span><span class="p">])</span>

        <span class="n">parent_group</span> <span class="o">=</span> <span class="n">group_name</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">membership_map</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">membership_map</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">member</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">membership_map</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">membership_map</span><span class="p">[</span><span class="n">parent_group</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">membership_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">(</span><span class="n">parent</span><span class="p">),</span> <span class="n">members_name</span><span class="o">=</span><span class="n">member</span><span class="p">))</span></div>

<div class="viewcode-block" id="InventoryImporter._store_iam_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._store_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">_store_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store the iam policy of the resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            policy (object): IAM policy to store.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if member could not be found in any cache.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bindings</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">get_resource_data</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bindings&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">policy_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">binding</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">:</span>
            <span class="n">role</span> <span class="o">=</span> <span class="n">binding</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">role</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_cache</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Role reference in iam policy not found: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># binding[&#39;members&#39;] can have duplicate ids</span>
            <span class="n">members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">binding</span><span class="p">[</span><span class="s1">&#39;members&#39;</span><span class="p">])</span>
            <span class="n">db_members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="n">member</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="c1"># We still might hit external users or groups</span>
                <span class="c1"># that we haven&#39;t seen in gsuite.</span>
                <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span> <span class="ow">and</span> <span class="n">member</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">db_members</span><span class="p">:</span>
                    <span class="n">db_members</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span><span class="p">[</span><span class="n">member</span><span class="p">])</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">member</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">member_cache</span> <span class="ow">and</span>
                        <span class="n">member</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">member_cache_policies</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># This is the default case, e.g. &#39;group/foobar&#39;</span>
                        <span class="n">m_type</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># Special groups like &#39;allUsers&#39; done specify a type</span>
                        <span class="n">m_type</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">member</span><span class="p">,</span> <span class="n">member</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">member_cache_policies</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_MEMBER</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">member</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">m_type</span><span class="p">,</span>
                        <span class="n">member_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">member_cache_policies</span><span class="p">[</span><span class="n">member</span><span class="p">])</span>
                <span class="n">db_members</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">member_cache_policies</span><span class="p">[</span><span class="n">member</span><span class="p">])</span>

            <span class="n">binding_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_BINDING</span><span class="p">(</span>
                <span class="n">resource_type_name</span><span class="o">=</span><span class="n">policy_type_name</span><span class="p">,</span>
                <span class="n">role_name</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
                <span class="n">members</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">db_members</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">binding_object</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_iam_policy</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._store_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._store_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_store_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store an inventory resource in the database.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (object): Resource object to convert from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;appengine_app&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_gae_resource</span><span class="p">,</span>
            <span class="s1">&#39;appengine_instance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_gae_instance_resource</span><span class="p">,</span>
            <span class="s1">&#39;appengine_service&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_gae_resource</span><span class="p">,</span>
            <span class="s1">&#39;appengine_version&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_gae_resource</span><span class="p">,</span>
            <span class="s1">&#39;backendservice&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;billing_account&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_billing_account</span><span class="p">,</span>
            <span class="s1">&#39;bucket&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_bucket</span><span class="p">,</span>
            <span class="s1">&#39;cloudsqlinstance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_cloudsqlinstance</span><span class="p">,</span>
            <span class="s1">&#39;compute_autoscaler&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_backendbucket&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_healthcheck&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_httphealthcheck&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_httpshealthcheck&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_license&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_project&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_router&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_sslcertificate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_targethttpproxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_targethttpsproxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_targetinstance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_targetpool&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_targetsslproxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_targettcpproxy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;compute_urlmap&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;crm_org_policy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_crm_org_policy</span><span class="p">,</span>
            <span class="s1">&#39;dataset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dataset</span><span class="p">,</span>
            <span class="s1">&#39;disk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;dns_managedzone&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_clouddns_resource</span><span class="p">,</span>
            <span class="s1">&#39;dns_policy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_clouddns_resource</span><span class="p">,</span>
            <span class="s1">&#39;firewall&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;folder&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_folder</span><span class="p">,</span>
            <span class="s1">&#39;forwardingrule&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;instance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;instancegroup&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;instancegroupmanager&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;instancetemplate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;kms_cryptokey&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_kms_resource</span><span class="p">,</span>
            <span class="s1">&#39;kms_cryptokeyversion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_kms_ckv_resource</span><span class="p">,</span>
            <span class="s1">&#39;kms_keyring&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_kms_resource</span><span class="p">,</span>
            <span class="s1">&#39;kubernetes_cluster&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_kubernetes_cluster</span><span class="p">,</span>
            <span class="s1">&#39;lien&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_lien</span><span class="p">,</span>
            <span class="s1">&#39;network&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;organization&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_organization</span><span class="p">,</span>
            <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_project</span><span class="p">,</span>
            <span class="s1">&#39;pubsub_topic&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_pubsub_topic</span><span class="p">,</span>
            <span class="s1">&#39;serviceaccount&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_serviceaccount</span><span class="p">,</span>
            <span class="s1">&#39;serviceaccount_key&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_serviceaccount_key</span><span class="p">,</span>
            <span class="s1">&#39;sink&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_sink</span><span class="p">,</span>
            <span class="s1">&#39;snapshot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="s1">&#39;spanner_database&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_spanner_db_resource</span><span class="p">,</span>
            <span class="s1">&#39;spanner_instance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_spanner_resource</span><span class="p">,</span>
            <span class="s1">&#39;subnetwork&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_computeengine_resource</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">res_type</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">()</span> <span class="k">if</span> <span class="n">resource</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handler</span><span class="p">:</span>
            <span class="n">handler</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="s1">&#39;No handler for type &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res_type</span><span class="p">))</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                          <span class="n">email_key</span><span class="o">=</span><span class="s1">&#39;email&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">            cached (bool): Set to true for resources that have child resources</span>
<span class="sd">                or policies associated with them.</span>
<span class="sd">            display_key (str): The key in the resource dictionary to lookup to</span>
<span class="sd">                get the display name for the resource.</span>
<span class="sd">            email_key (str): The key in the resource dictionary to lookup to get</span>
<span class="sd">                the email associated with the resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_resource_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_root</span><span class="p">(</span><span class="n">resource</span><span class="p">):</span>
            <span class="n">parent</span><span class="p">,</span> <span class="n">type_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
            <span class="n">full_res_name</span> <span class="o">=</span> <span class="n">to_full_resource_name</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">type_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent</span><span class="p">,</span> <span class="n">full_res_name</span><span class="p">,</span> <span class="n">type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_resource_name</span><span class="p">(</span>
                <span class="n">resource</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_RESOURCE</span><span class="p">(</span>
            <span class="n">full_name</span><span class="o">=</span><span class="n">full_res_name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">(),</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">(),</span>
            <span class="n">display_name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">display_key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">email</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email_key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">get_resource_data_raw</span><span class="p">(),</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_to_cache</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_billing_account"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_billing_account">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_billing_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">billing_account</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a billing account to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            billing_account (object): billing account to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">billing_account</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;displayName&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_bucket"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_bucket">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a bucket to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            bucket (object): Bucket to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_clouddns_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_clouddns_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_clouddns_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a CloudDNS resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_computeengine_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_computeengine_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_computeengine_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an AppEngine resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): An appengine resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_crm_org_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_crm_org_policy">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_crm_org_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">org_policy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an org policy to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            org_policy (object): org policy to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">org_policy</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;constraint&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_dataset"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a dataset to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset (object): Dataset to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_folder"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_folder">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a folder to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder (object): Folder to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;displayName&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_gae_instance_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_gae_instance_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_gae_instance_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an AppEngine Instance resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_gae_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_gae_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_gae_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an AppEngine resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_kms_ckv_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_kms_ckv_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_kms_ckv_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a KMS CryptoKeyVersion resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># No child resources, so do not cache.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_kms_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_kms_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_kms_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a KMS resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_kubernetes_cluster"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_kubernetes_cluster">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_kubernetes_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an AppEngine resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            cluster (dict): A Kubernetes cluster resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_lien"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_lien">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_lien</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lien</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a lien to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            lien (object): Lien to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">lien</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_organization"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_organization">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an organization a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            organization (object): Organization to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">organization</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;displayName&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_pubsub_topic"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_pubsub_topic">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_pubsub_topic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a PubSub Topic to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            topic (object): Pubsub Topic to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_project"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_project">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a project to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            project (object): Project to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_serviceaccount"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_serviceaccount">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_serviceaccount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_account</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a service account to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            service_account (object): Service account to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">service_account</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;displayName&#39;</span><span class="p">,</span> <span class="n">email_key</span><span class="o">=</span><span class="s1">&#39;email&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_serviceaccount_key"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_serviceaccount_key">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_serviceaccount_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_account_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a service account key to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            service_account_key (object): Service account key to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">service_account_key</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_sink"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_sink">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_sink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sink</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a log sink to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            sink (object): Sink to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">email_key</span><span class="o">=</span><span class="s1">&#39;writerIdentity&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_spanner_db_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_spanner_db_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_spanner_db_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a Spanner Database resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_spanner_resource"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_spanner_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_spanner_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a Spanner Instance resource to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (dict): A resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">display_key</span><span class="o">=</span><span class="s1">&#39;displayName&#39;</span><span class="p">)</span></div>

    <span class="c1"># The following methods require more complex logic than _convert_resource</span>
    <span class="c1"># provides.</span>
<div class="viewcode-block" id="InventoryImporter._convert_cloudsqlinstance"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_cloudsqlinstance">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_cloudsqlinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cloudsqlinstance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a cloudsqlinstance to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            cloudsqlinstance (object): Cloudsql to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cloudsqlinstance</span><span class="o">.</span><span class="n">get_resource_data</span><span class="p">()</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">full_res_name</span><span class="p">,</span> <span class="n">type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_resource_name</span><span class="p">(</span>
            <span class="n">cloudsqlinstance</span><span class="p">)</span>
        <span class="n">parent_key</span> <span class="o">=</span> <span class="n">get_resource_id_from_type_name</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
        <span class="n">resource_identifier</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span>
                                             <span class="n">cloudsqlinstance</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">())</span>
        <span class="n">type_name</span> <span class="o">=</span> <span class="n">to_type_name</span><span class="p">(</span><span class="n">cloudsqlinstance</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">(),</span>
                                 <span class="n">resource_identifier</span><span class="p">)</span>

        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_RESOURCE</span><span class="p">(</span>
            <span class="n">full_name</span><span class="o">=</span><span class="n">full_res_name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">cloudsqlinstance</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">(),</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">cloudsqlinstance</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">(),</span>
            <span class="n">display_name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;displayName&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">email</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">cloudsqlinstance</span><span class="o">.</span><span class="n">get_resource_data_raw</span><span class="p">(),</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_dataset_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_dataset_policy">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_dataset_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_policy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a dataset policy to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_policy (object): Dataset policy to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Dataset policies should be integrated in the model, not stored</span>
        <span class="c1"># as a resource.</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">full_res_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parent</span><span class="p">(</span><span class="n">dataset_policy</span><span class="p">)</span>
        <span class="n">policy_type_name</span> <span class="o">=</span> <span class="n">to_type_name</span><span class="p">(</span>
            <span class="n">dataset_policy</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="n">dataset_policy</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">())</span>
        <span class="n">policy_res_name</span> <span class="o">=</span> <span class="n">to_full_resource_name</span><span class="p">(</span><span class="n">full_res_name</span><span class="p">,</span> <span class="n">policy_type_name</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_RESOURCE</span><span class="p">(</span>
            <span class="n">full_name</span><span class="o">=</span><span class="n">policy_res_name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">policy_type_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">dataset_policy</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">(),</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">dataset_policy</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">dataset_policy</span><span class="o">.</span><span class="n">get_resource_data_raw</span><span class="p">(),</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_enabled_apis"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_enabled_apis">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_enabled_apis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled_apis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a description of enabled APIs to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            enabled_apis (object): Enabled APIs description to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">full_res_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parent</span><span class="p">(</span><span class="n">enabled_apis</span><span class="p">)</span>
        <span class="n">apis_type_name</span> <span class="o">=</span> <span class="n">to_type_name</span><span class="p">(</span>
            <span class="n">enabled_apis</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)))</span>
        <span class="n">apis_res_name</span> <span class="o">=</span> <span class="n">to_full_resource_name</span><span class="p">(</span><span class="n">full_res_name</span><span class="p">,</span> <span class="n">apis_type_name</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_RESOURCE</span><span class="p">(</span>
            <span class="n">full_name</span><span class="o">=</span><span class="n">apis_res_name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">apis_type_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">enabled_apis</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">(),</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">enabled_apis</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">enabled_apis</span><span class="o">.</span><span class="n">get_resource_data_raw</span><span class="p">(),</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_iam_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iam_policy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an IAM policy to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            iam_policy (object): IAM policy to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">full_res_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parent</span><span class="p">(</span><span class="n">iam_policy</span><span class="p">)</span>
        <span class="n">parent_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">(</span><span class="n">iam_policy</span><span class="p">)</span>
        <span class="n">iam_policy_type_name</span> <span class="o">=</span> <span class="n">to_type_name</span><span class="p">(</span>
            <span class="n">iam_policy</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent_type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)))</span>
        <span class="n">iam_policy_full_res_name</span> <span class="o">=</span> <span class="n">to_full_resource_name</span><span class="p">(</span>
            <span class="n">full_res_name</span><span class="p">,</span>
            <span class="n">iam_policy_type_name</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_RESOURCE</span><span class="p">(</span>
            <span class="n">full_name</span><span class="o">=</span><span class="n">iam_policy_full_res_name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">iam_policy_type_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">iam_policy</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">(),</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">iam_policy</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">iam_policy</span><span class="o">.</span><span class="n">get_resource_data_raw</span><span class="p">(),</span>
            <span class="n">parent_type_name</span><span class="o">=</span><span class="n">parent_type_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_role"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_role">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a role to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            role (object): Role to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">role</span><span class="o">.</span><span class="n">get_resource_data</span><span class="p">()</span>
        <span class="n">is_custom</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;roles/&#39;</span><span class="p">)</span>
        <span class="n">db_permissions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;includedPermissions&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                <span class="s1">&#39;Role missing permissions: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;missing name&gt;&#39;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">perm_name</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;includedPermissions&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">perm_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">permission_cache</span><span class="p">:</span>
                    <span class="n">permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_PERMISSION</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">perm_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">permission_cache</span><span class="p">[</span><span class="n">perm_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">permission</span>
                <span class="n">db_permissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_cache</span><span class="p">[</span><span class="n">perm_name</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_role_unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]):</span>
            <span class="k">return</span>
        <span class="n">dbrole</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_ROLE</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">title</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">stage</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stage&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">custom</span><span class="o">=</span><span class="n">is_custom</span><span class="p">,</span>
            <span class="n">permissions</span><span class="o">=</span><span class="n">db_permissions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">role_cache</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dbrole</span>

        <span class="k">if</span> <span class="n">is_custom</span><span class="p">:</span>
            <span class="n">parent</span><span class="p">,</span> <span class="n">full_res_name</span><span class="p">,</span> <span class="n">type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_resource_name</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
            <span class="n">role_resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_RESOURCE</span><span class="p">(</span>
                <span class="n">full_name</span><span class="o">=</span><span class="n">full_res_name</span><span class="p">,</span>
                <span class="n">type_name</span><span class="o">=</span><span class="n">type_name</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">role</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">(),</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">role</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">(),</span>
                <span class="n">display_name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">),</span>
                <span class="n">data</span><span class="o">=</span><span class="n">role</span><span class="o">.</span><span class="n">get_resource_data_raw</span><span class="p">(),</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_to_cache</span><span class="p">(</span><span class="n">role_resource</span><span class="p">,</span> <span class="n">role</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">role_resource</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_role_post"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_role_post">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_role_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executed after all roles were handled. Performs bulk insert.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_cache</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_cache</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

<div class="viewcode-block" id="InventoryImporter._convert_service_config"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._convert_service_config">[docs]</a>    <span class="k">def</span> <span class="nf">_convert_service_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert Kubernetes Service Config to a database object.</span>

<span class="sd">        Args:</span>
<span class="sd">            service_config (dict): A Service Config resource to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">full_res_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parent</span><span class="p">(</span><span class="n">service_config</span><span class="p">)</span>
        <span class="n">sc_type_name</span> <span class="o">=</span> <span class="n">to_type_name</span><span class="p">(</span>
            <span class="n">service_config</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">type_name</span><span class="p">)</span>
        <span class="n">sc_res_name</span> <span class="o">=</span> <span class="n">to_full_resource_name</span><span class="p">(</span><span class="n">full_res_name</span><span class="p">,</span> <span class="n">sc_type_name</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">TBL_RESOURCE</span><span class="p">(</span>
            <span class="n">full_name</span><span class="o">=</span><span class="n">sc_res_name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">sc_type_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">service_config</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">(),</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">service_config</span><span class="o">.</span><span class="n">get_category</span><span class="p">(),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">service_config</span><span class="o">.</span><span class="n">get_resource_data_raw</span><span class="p">(),</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._add_to_cache"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._add_to_cache">[docs]</a>    <span class="k">def</span> <span class="nf">_add_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a resource to the cache for parent lookup.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (object): Resource to put in the cache.</span>
<span class="sd">            resource_id (int): The database key for the resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">full_res_name</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">full_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_cache</span><span class="p">[</span><span class="n">resource_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">full_res_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="InventoryImporter._full_resource_name"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._full_resource_name">[docs]</a>    <span class="k">def</span> <span class="nf">_full_resource_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the parent object, full resource name and type name.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (object): Resource whose full resource name and parent</span>
<span class="sd">            should be returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: full resource name for the provided resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">full_res_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parent</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="n">full_resource_name</span> <span class="o">=</span> <span class="n">to_full_resource_name</span><span class="p">(</span><span class="n">full_res_name</span><span class="p">,</span> <span class="n">type_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parent</span><span class="p">,</span> <span class="n">full_resource_name</span><span class="p">,</span> <span class="n">type_name</span></div>

<div class="viewcode-block" id="InventoryImporter._get_parent"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._get_parent">[docs]</a>    <span class="k">def</span> <span class="nf">_get_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the parent object for a resource from cache.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (object): Resource whose parent to look for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: cached object and full resource name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_parent_id</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_cache</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="InventoryImporter._is_role_unique"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._is_role_unique">[docs]</a>    <span class="k">def</span> <span class="nf">_is_role_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check to see if the session contains Role with</span>
<span class="sd">        primary key = role_name.</span>

<span class="sd">        Args:</span>
<span class="sd">            role_name (str): The role name (Primary key of the role table).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether or not session contains Role with</span>
<span class="sd">                primary key = role_name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># one_or_none returns None if the query selects no rows.</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">role_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_cache</span>

        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Duplicate role_name: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">role_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="InventoryImporter._is_root"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._is_root">[docs]</a>    <span class="k">def</span> <span class="nf">_is_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the resource is an inventory root. Result is cached.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (object): Resource to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the resource is root or not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">found_root</span><span class="p">:</span>
            <span class="n">is_root</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_parent_id</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">is_root</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">found_root</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">is_root</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="InventoryImporter._type_name"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.InventoryImporter._type_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_type_name</span><span class="p">(</span><span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the type/name for that resource.</span>

<span class="sd">        This is a simple wrapper for the to_type_name function.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource (object): Resource to retrieve type/name for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: type/name representation of the resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">to_type_name</span><span class="p">(</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">get_resource_type</span><span class="p">(),</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">get_resource_id</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="by_source"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.model.importer.importer.html#google.cloud.forseti.services.model.importer.importer.by_source">[docs]</a><span class="k">def</span> <span class="nf">by_source</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper to resolve client provided import sources.</span>

<span class="sd">    Args:</span>
<span class="sd">        source (str): Source to import from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Importer: Chosen by source.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;INVENTORY&#39;</span><span class="p">:</span> <span class="n">InventoryImporter</span><span class="p">,</span>
        <span class="s1">&#39;EMPTY&#39;</span><span class="p">:</span> <span class="n">EmptyImporter</span><span class="p">,</span>
    <span class="p">}[</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span></div>
</pre></div>
