---
layout: docs

title: "google.cloud.forseti.services.inventory.base.cai_gcp_client"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.services.inventory.base.cai_gcp_client</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2018 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Cloud Asset and GCP API hybrid client fassade.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">from</span> <span class="nn">google.cloud.forseti.services</span> <span class="k">import</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.inventory.base</span> <span class="k">import</span> <span class="n">gcp</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.inventory.storage</span> <span class="k">import</span> <span class="n">CaiDataAccess</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.inventory.storage</span> <span class="k">import</span> <span class="n">ContentTypes</span>

<span class="n">LOCAL_THREAD</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>


<span class="c1"># pylint: disable=too-many-public-methods</span>
<div class="viewcode-block" id="CaiApiClientImpl"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl">[docs]</a><span class="k">class</span> <span class="nc">CaiApiClientImpl</span><span class="p">(</span><span class="n">gcp</span><span class="o">.</span><span class="n">ApiClientImpl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The gcp api client Implementation&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Args:</span>
<span class="sd">            config (dict): GCP API client configuration.</span>
<span class="sd">            engine (object): Database engine to operate on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dao</span> <span class="o">=</span> <span class="n">CaiDataAccess</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local</span> <span class="o">=</span> <span class="n">LOCAL_THREAD</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a thread local CAI read only session object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            object: A thread local Session.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local</span><span class="p">,</span> <span class="s1">&#39;cai_session&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local</span><span class="o">.</span><span class="n">cai_session</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_local</span><span class="o">.</span><span class="n">cai_session</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">create_readonly_session</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local</span><span class="o">.</span><span class="n">cai_session</span>

    <span class="c1"># def iter_compute_backendservices(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Backend services from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of backend service.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.BackendService&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for backendservice in resources:</span>
    <span class="c1">#         yield backendservice</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_disks(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Compute Engine disks from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of Compute Disk.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.Disk&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for disk in resources:</span>
    <span class="c1">#         yield disk</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_firewalls(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Compute Engine Firewalls from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of Compute Engine Firewall.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.Firewall&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for rule in resources:</span>
    <span class="c1">#         yield rule</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_images(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Images from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of image resources.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.Image&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for image in resources:</span>
    <span class="c1">#         yield image</span>
    <span class="c1">#</span>
    <span class="c1"># # Use live API because CAI does not yet have all instance groups.</span>
    <span class="c1"># # def iter_compute_instancegroups(self, project_number):</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_instances(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate compute engine instance from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of Compute Engine Instance resources.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.Instance&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for instance in resources:</span>
    <span class="c1">#         yield instance</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_instancetemplates(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Instance Templates from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of instance template resources.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.InstanceTemplate&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for instancetemplate in resources:</span>
    <span class="c1">#         yield instancetemplate</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_networks(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Networks from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of network resources.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.Network&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for network in resources:</span>
    <span class="c1">#         yield network</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_snapshots(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Compute Engine snapshots from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of Compute Snapshots.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.Snapshot&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for snapshot in resources:</span>
    <span class="c1">#         yield snapshot</span>
    <span class="c1">#</span>
    <span class="c1"># def iter_compute_subnetworks(self, project_number):</span>
    <span class="c1">#     &quot;&quot;&quot;Iterate Subnetworks from Cloud Asset data.</span>
    <span class="c1">#</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#         project_number (str): id of the project to query.</span>
    <span class="c1">#</span>
    <span class="c1">#     Yields:</span>
    <span class="c1">#         dict: Generator of subnetwork resources.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     resources = self.dao.iter_cai_assets(</span>
    <span class="c1">#         ContentTypes.resource,</span>
    <span class="c1">#         &#39;google.compute.Subnetwork&#39;,</span>
    <span class="c1">#         &#39;//cloudresourcemanager.googleapis.com/projects/{}&#39;.format(</span>
    <span class="c1">#             project_number),</span>
    <span class="c1">#         self.session)</span>
    <span class="c1">#     for subnetwork in resources:</span>
    <span class="c1">#         yield subnetwork</span>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_crm_folder"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_crm_folder">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_crm_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch Folder data from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_id (str): id of the folder to query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Folder resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Folder&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">folder_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource</span>
        <span class="c1"># Fall back to live API if the data isn&#39;t in the CAI cache.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_crm_folder</span><span class="p">(</span><span class="n">folder_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_crm_folder_iam_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_crm_folder_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_crm_folder_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Folder IAM policy in a folder from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_id (str): id of the folder to get policy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Folder IAM policy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">iam_policy</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Folder&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">folder_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource</span>
        <span class="c1"># Fall back to live API if the data isn&#39;t in the CAI cache.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_crm_folder_iam_policy</span><span class="p">(</span>
            <span class="n">folder_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_crm_organization"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_crm_organization">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_crm_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">org_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch Organization data from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            org_id (str): id of the organization to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Organization resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Organization&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">org_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource</span>
        <span class="c1"># Fall back to live API if the data isn&#39;t in the CAI cache.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_crm_organization</span><span class="p">(</span><span class="n">org_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_crm_organization_iam_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_crm_organization_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_crm_organization_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">org_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Organization IAM policy from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            org_id (str): id of the organization to get policy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Organization IAM policy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">iam_policy</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Organization&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">org_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource</span>
        <span class="c1"># Fall back to live API if the data isn&#39;t in the CAI cache.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_crm_organization_iam_policy</span><span class="p">(</span>
            <span class="n">org_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_crm_project"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_crm_project">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_crm_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch Project data from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_number (str): id of the project to query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Project resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Project&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/projects/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_number</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource</span>
        <span class="c1"># Fall back to live API if the data isn&#39;t in the CAI cache.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_crm_project</span><span class="p">(</span><span class="n">project_number</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_crm_project_iam_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_crm_project_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_crm_project_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Project IAM policy from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_number (str): id of the project to query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Project IAM Policy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">iam_policy</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Project&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/projects/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_number</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource</span>
        <span class="c1"># Fall back to live API if the data isn&#39;t in the CAI cache.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_crm_project_iam_policy</span><span class="p">(</span>
            <span class="n">project_number</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.iter_crm_folders"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.iter_crm_folders">[docs]</a>    <span class="k">def</span> <span class="nf">iter_crm_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate Folders from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_id (str): id of the parent of the folder</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: Generator of folders</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">iter_cai_assets</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Folder&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">folder</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.iter_crm_projects"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.iter_crm_projects">[docs]</a>    <span class="k">def</span> <span class="nf">iter_crm_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_type</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate Projects from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_type (str): type of the parent, &quot;folder&quot; or &quot;organization&quot;.</span>
<span class="sd">            parent_id (str): id of the parent of the folder.</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: Generator of Project resources</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">iter_cai_assets</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.resourcemanager.Project&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//cloudresourcemanager.googleapis.com/</span><span class="si">{}</span><span class="s1">s/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent_type</span><span class="p">,</span>
                                                                  <span class="n">parent_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">project</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_gae_app"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_gae_app">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_gae_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch the AppEngine App from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_id (str): id of the project to query</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: AppEngine App resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.appengine.Application&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//appengine.googleapis.com/apps/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resource</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.iter_gae_services"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.iter_gae_services">[docs]</a>    <span class="k">def</span> <span class="nf">iter_gae_services</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate gae services from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_id (str): id of the project to query</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: Generator of AppEngine Service resources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">iter_cai_assets</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.appengine.Service&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//appengine.googleapis.com/apps/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">service</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.iter_gae_versions"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.iter_gae_versions">[docs]</a>    <span class="k">def</span> <span class="nf">iter_gae_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">service_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterate gae versions from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_id (str): id of the project to query</span>
<span class="sd">            service_id (str): id of the appengine service</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: Generator of AppEngine Version resources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">iter_cai_assets</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;google.appengine.Version&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//appengine.googleapis.com/apps/</span><span class="si">{}</span><span class="s1">/services/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span>
                                                                    <span class="n">service_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">version</span></div>

<div class="viewcode-block" id="CaiApiClientImpl.fetch_storage_bucket_iam_policy"><a class="viewcode-back" href="../../../../../../../google.cloud.forseti.services.inventory.base.cai_gcp_client.html#google.cloud.forseti.services.inventory.base.cai_gcp_client.CaiApiClientImpl.fetch_storage_bucket_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_storage_bucket_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bucket IAM policy Iterator from Cloud Asset data.</span>

<span class="sd">        Args:</span>
<span class="sd">            bucket_id (str): id of the bucket to query</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Bucket IAM policy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">fetch_cai_asset</span><span class="p">(</span>
            <span class="n">ContentTypes</span><span class="o">.</span><span class="n">iam_policy</span><span class="p">,</span>
            <span class="s1">&#39;google.cloud.storage.Bucket&#39;</span><span class="p">,</span>
            <span class="s1">&#39;//storage.googleapis.com/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket_id</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource</span>
        <span class="c1"># Fall back to live API if the data isn&#39;t in the CAI cache.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaiApiClientImpl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_storage_bucket_iam_policy</span><span class="p">(</span>
            <span class="n">bucket_id</span><span class="p">)</span></div></div>

    <span class="c1"># Use live API because CAI does not yet have bucket ACLs.</span>
    <span class="c1"># def iter_storage_buckets(self, project_number):</span>
</pre></div>
