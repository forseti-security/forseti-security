---
layout: docs

title: "google.cloud.forseti.services.model.service"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.services.model.service</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2017 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Forseti Server model gRPC service.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="k">import</span> <span class="n">string_formats</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.model</span> <span class="k">import</span> <span class="n">model_pb2</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.model</span> <span class="k">import</span> <span class="n">model_pb2_grpc</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.services.model</span> <span class="k">import</span> <span class="n">modeller</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="k">import</span> <span class="n">logger</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="GrpcModeller"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller">[docs]</a><span class="k">class</span> <span class="nc">GrpcModeller</span><span class="p">(</span><span class="n">model_pb2_grpc</span><span class="o">.</span><span class="n">ModellerServicer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Modeller gRPC implementation.&quot;&quot;&quot;</span>

    <span class="n">HANDLE_KEY</span> <span class="o">=</span> <span class="s1">&#39;handle&#39;</span>

<div class="viewcode-block" id="GrpcModeller._get_handle"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller._get_handle">[docs]</a>    <span class="k">def</span> <span class="nf">_get_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the handle associated with the gRPC call.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (object): GRPC context</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: handle of the GRPC call</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">invocation_metadata</span><span class="p">()</span>
        <span class="n">metadata_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">metadata_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">metadata_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">HANDLE_KEY</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modeller_api</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize</span>

<span class="sd">        Args:</span>
<span class="sd">            modeller_api (object): model library</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GrpcModeller</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modeller</span> <span class="o">=</span> <span class="n">modeller_api</span>

<div class="viewcode-block" id="GrpcModeller.Ping"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller.Ping">[docs]</a>    <span class="k">def</span> <span class="nf">Ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the capability to check for service availability.</span>

<span class="sd">        Args:</span>
<span class="sd">            request (object): pb2 object of PingRequest</span>
<span class="sd">            _(object): Not used</span>

<span class="sd">        Returns:</span>
<span class="sd">            object: pb2 object of the PingReply</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">PingReply</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrpcModeller.CreateModel"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller.CreateModel">[docs]</a>    <span class="k">def</span> <span class="nf">CreateModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new model from an import source.</span>

<span class="sd">        Args:</span>
<span class="sd">            request (object): pb2 object of CreateModelRequest</span>
<span class="sd">            context (object): gRPC context</span>

<span class="sd">        Returns:</span>
<span class="sd">            object: pb2 object of ModelSimplified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Received request to create model: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeller</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                                           <span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                           <span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                           <span class="n">request</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
        <span class="n">created_at_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_created_at_str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Model </span><span class="si">%s</span><span class="s1"> created at: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">created_at_str</span><span class="p">)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">CreateModelReply</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model_pb2</span><span class="o">.</span><span class="n">ModelSimplified</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">handle</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="n">createdAt</span><span class="o">=</span><span class="n">created_at_str</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reply</span></div>

<div class="viewcode-block" id="GrpcModeller.DeleteModel"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller.DeleteModel">[docs]</a>    <span class="k">def</span> <span class="nf">DeleteModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a model and all associated data.</span>

<span class="sd">        Args:</span>
<span class="sd">            request (object): pb2 object of DeleteModelRequest</span>
<span class="sd">            _ (object): Not used</span>

<span class="sd">        Returns:</span>
<span class="sd">            object: pb2 object of DeleteModelReply</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">handle</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modeller</span><span class="o">.</span><span class="n">delete_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">DeleteModelReply</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s1">&#39;SUCCESS&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Unable to delete model: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
            <span class="c1"># pylint: disable=no-member</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">DeleteModelReply</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s1">&#39;FAIL&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">DeleteModelReply</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrpcModeller.ListModel"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller.ListModel">[docs]</a>    <span class="k">def</span> <span class="nf">ListModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List all models.</span>

<span class="sd">        Args:</span>
<span class="sd">            request (object): pb2 object of ListModelRequest</span>
<span class="sd">            _ (object): Not used</span>

<span class="sd">        Yields:</span>
<span class="sd">            object: pb2 object of ModelSimplified</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeller</span><span class="o">.</span><span class="n">list_model</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
            <span class="n">created_at_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_created_at_str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">ModelSimplified</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                            <span class="n">handle</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>
                                            <span class="n">status</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                                            <span class="n">createdAt</span><span class="o">=</span><span class="n">created_at_str</span><span class="p">,</span>
                                            <span class="n">description</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                                            <span class="n">message</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrpcModeller.GetModel"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller.GetModel">[docs]</a>    <span class="k">def</span> <span class="nf">GetModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get details of a model.</span>

<span class="sd">        Args:</span>
<span class="sd">            request (object): pb2 object of GetModelRequest</span>
<span class="sd">            _ (object): Not used</span>

<span class="sd">        Returns:</span>
<span class="sd">            object: pb2 object of ModelDetails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeller</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
            <span class="n">created_at_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_created_at_str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">ModelDetails</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                          <span class="n">handle</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>
                                          <span class="n">status</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                                          <span class="n">createdAt</span><span class="o">=</span><span class="n">created_at_str</span><span class="p">,</span>
                                          <span class="n">description</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                                          <span class="n">message</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                                          <span class="n">warnings</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_pb2</span><span class="o">.</span><span class="n">ModelDetails</span><span class="p">()</span></div>

<div class="viewcode-block" id="GrpcModeller._get_model_created_at_str"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModeller._get_model_created_at_str">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_model_created_at_str</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get model created_at datetime in human readable string format.</span>

<span class="sd">        Args:</span>
<span class="sd">            model (Model): Model dao object.</span>

<span class="sd">        Return:</span>
<span class="sd">            str: created_at datetime in string format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">created_at_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
            <span class="n">string_formats</span><span class="o">.</span><span class="n">DEFAULT_FORSETI_HUMAN_TIMESTAMP</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GrpcModellerFactory"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModellerFactory">[docs]</a><span class="k">class</span> <span class="nc">GrpcModellerFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Factory class for model service gRPC interface&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize</span>

<span class="sd">        Args:</span>
<span class="sd">            config (object): ServiceConfig in server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

<div class="viewcode-block" id="GrpcModellerFactory.create_and_register_service"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.model.service.html#google.cloud.forseti.services.model.service.GrpcModellerFactory.create_and_register_service">[docs]</a>    <span class="k">def</span> <span class="nf">create_and_register_service</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and register the Model service.</span>

<span class="sd">        Args:</span>
<span class="sd">            server (object): Server to register service to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            object: The instantiated gRPC service for model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">service</span> <span class="o">=</span> <span class="n">GrpcModeller</span><span class="p">(</span><span class="n">modeller_api</span><span class="o">=</span><span class="n">modeller</span><span class="o">.</span><span class="n">Modeller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">))</span>
        <span class="n">model_pb2_grpc</span><span class="o">.</span><span class="n">add_ModellerServicer_to_server</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">server</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Service </span><span class="si">%s</span><span class="s1"> created and registered&#39;</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">service</span></div></div>
</pre></div>
