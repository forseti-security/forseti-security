---
layout: docs

title: "google.cloud.forseti.services.explain.explainer"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.services.explain.explainer</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2017 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot; Explain API. &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="k">import</span> <span class="n">logger</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Explainer"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer">[docs]</a><span class="k">class</span> <span class="nc">Explainer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implements the Explain API.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize</span>

<span class="sd">        Args:</span>
<span class="sd">            config (object): ServiceConfig in server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

<div class="viewcode-block" id="Explainer.list_resources"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.list_resources">[docs]</a>    <span class="k">def</span> <span class="nf">list_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">full_resource_name_prefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lists resources by resource name prefix.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            full_resource_name_prefix (ste): the prefix of the resource name</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of Resources match the query</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Listing resources, model_name = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; full_resource_name_prefix = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">full_resource_name_prefix</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data_access</span><span class="o">.</span><span class="n">list_resources_by_prefix</span><span class="p">(</span>
                <span class="n">session</span><span class="p">,</span> <span class="n">full_resource_name_prefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Explainer.list_group_members"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.list_group_members">[docs]</a>    <span class="k">def</span> <span class="nf">list_group_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">member_name_prefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lists a member from the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            member_name_prefix (str): the prefix of the member_name</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of Members that match the query</span>
<span class="sd">            &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Listing Group members, model_name = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; member_name_prefix = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">member_name_prefix</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data_access</span><span class="o">.</span><span class="n">list_group_members</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">member_name_prefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Explainer.list_roles"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.list_roles">[docs]</a>    <span class="k">def</span> <span class="nf">list_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">role_name_prefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lists the role in the model matching the prefix.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            role_name_prefix (str): prefix of the role_name</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of role_names that match the query</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Listing roles, model_name = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                    <span class="s1">&#39; role_name_prefix = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">role_name_prefix</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data_access</span><span class="o">.</span><span class="n">list_roles_by_prefix</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">role_name_prefix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Explainer.get_iam_policy"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.get_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">get_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the IAM policy for the resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            resource (str): Resource to query</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: the IAM policy</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Retrieving IAM policy, model_name = </span><span class="si">%s</span><span class="s1">, resource = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data_access</span><span class="o">.</span><span class="n">get_iam_policy</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span></div>

<div class="viewcode-block" id="Explainer.check_iam_policy"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.check_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">check_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">identity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks access according to IAM policy for the resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            resource (str): Resource to check</span>
<span class="sd">            permission (str): Permission to check</span>
<span class="sd">            identity (str): Member to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: whether such access is allowed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Checking IAM policy, model_name = </span><span class="si">%s</span><span class="s1">, resource = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; permission = </span><span class="si">%s</span><span class="s1">, identity = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">identity</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data_access</span><span class="o">.</span><span class="n">check_iam_policy</span><span class="p">(</span>
                <span class="n">session</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">identity</span><span class="p">)</span></div>

<div class="viewcode-block" id="Explainer.explain_denied"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.explain_denied">[docs]</a>    <span class="k">def</span> <span class="nf">explain_denied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">permissions</span><span class="p">,</span> <span class="n">roles</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides information on granting a member access to a resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            member (str): Member to query</span>
<span class="sd">            resources (list): Resources to query</span>
<span class="sd">            permissions (list): Permissions to query</span>
<span class="sd">            roles (list): Roles to query</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of tuples,</span>
<span class="sd">            (overgranting,[(role_name,member_name,resource_name)])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Explaining how to grant access to a member,&#39;</span>
                     <span class="s1">&#39; model_name = </span><span class="si">%s</span><span class="s1">, member = </span><span class="si">%s</span><span class="s1">, resources = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; permissions = </span><span class="si">%s</span><span class="s1">, roles = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">permissions</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">data_access</span><span class="o">.</span><span class="n">explain_denied</span><span class="p">(</span><span class="n">session</span><span class="p">,</span>
                                                <span class="n">member</span><span class="p">,</span>
                                                <span class="n">resources</span><span class="p">,</span>
                                                <span class="n">permissions</span><span class="p">,</span>
                                                <span class="n">roles</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Explainer.explain_granted"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.explain_granted">[docs]</a>    <span class="k">def</span> <span class="nf">explain_granted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">permission</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides information on why a member has access to a resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            member (str): Member to query</span>
<span class="sd">            resource (str): Resource to query</span>
<span class="sd">            role (str): Role to query</span>
<span class="sd">            permission (str): Permission to query</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuples: (bindings, member_graph, resource_type_names)</span>
<span class="sd">            bindings, the bindings to grant the access</span>
<span class="sd">            member_graph, the graph to have member included in the binding</span>
<span class="sd">            resource_type_names, the resource tree</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Explaining why the member has access to a resource,&#39;</span>
                     <span class="s1">&#39; model_name = </span><span class="si">%s</span><span class="s1">, member = </span><span class="si">%s</span><span class="s1">, resource = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; permission = </span><span class="si">%s</span><span class="s1">, role = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">data_access</span><span class="o">.</span><span class="n">explain_granted</span><span class="p">(</span><span class="n">session</span><span class="p">,</span>
                                                 <span class="n">member</span><span class="p">,</span>
                                                 <span class="n">resource</span><span class="p">,</span>
                                                 <span class="n">role</span><span class="p">,</span>
                                                 <span class="n">permission</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Explainer.get_access_by_resources"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.get_access_by_resources">[docs]</a>    <span class="k">def</span> <span class="nf">get_access_by_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span>
                                <span class="n">permission_names</span><span class="p">,</span> <span class="n">expand_groups</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns members who have access to the given resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            resource_name (str): Resource name to query for.</span>
<span class="sd">            permission_names (list): Permission names to query for.</span>
<span class="sd">            expand_groups (bool): Whether to expand groups in policies.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: role_member_mapping, &lt;&quot;role_name&quot;, &quot;member_names&quot;&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Retrieving members that have access to the resource,&#39;</span>
                     <span class="s1">&#39; model_name = </span><span class="si">%s</span><span class="s1">, resource_name = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; permission_names = </span><span class="si">%s</span><span class="s1">, expand_groups = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span>
                     <span class="n">permission_names</span><span class="p">,</span> <span class="n">expand_groups</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">data_access</span><span class="o">.</span><span class="n">query_access_by_resource</span><span class="p">(</span><span class="n">session</span><span class="p">,</span>
                                                           <span class="n">resource_name</span><span class="p">,</span>
                                                           <span class="n">permission_names</span><span class="p">,</span>
                                                           <span class="n">expand_groups</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mapping</span></div>

<div class="viewcode-block" id="Explainer.get_access_by_permissions"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.get_access_by_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">get_access_by_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">role_name</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span>
                                  <span class="n">expand_groups</span><span class="p">,</span> <span class="n">expand_resources</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns access tuples satisfying the permission or role.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            role_name (str): Role name to query for.</span>
<span class="sd">            permission_name (str): Permission name to query for.</span>
<span class="sd">            expand_groups (bool): Whether to expand groups in policies.</span>
<span class="sd">            expand_resources (bool): Whether to expand resources.</span>

<span class="sd">        Yields:</span>
<span class="sd">            tuple: Generator for (role, resource, members).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Retrieving access tuples that satisfy the role or&#39;</span>
                     <span class="s1">&#39; permission: model_name = </span><span class="si">%s</span><span class="s1">, role_name = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; permission_name = </span><span class="si">%s</span><span class="s1">, expand_groups = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; expand_resources = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">role_name</span><span class="p">,</span>
                     <span class="n">permission_name</span><span class="p">,</span> <span class="n">expand_groups</span><span class="p">,</span> <span class="n">expand_resources</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">role</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">members</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">data_access</span><span class="o">.</span><span class="n">query_access_by_permission</span><span class="p">(</span><span class="n">session</span><span class="p">,</span>
                                                           <span class="n">role_name</span><span class="p">,</span>
                                                           <span class="n">permission_name</span><span class="p">,</span>
                                                           <span class="n">expand_groups</span><span class="p">,</span>
                                                           <span class="n">expand_resources</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="n">role</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">members</span></div>

<div class="viewcode-block" id="Explainer.get_access_by_members"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.get_access_by_members">[docs]</a>    <span class="k">def</span> <span class="nf">get_access_by_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">permission_names</span><span class="p">,</span>
                              <span class="n">expand_resources</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns access to resources for the provided member.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            member_name (str): Member name to query</span>
<span class="sd">            permission_names (list): Permission names to query for.</span>
<span class="sd">            expand_resources (bool): Whether to expand resources.</span>

<span class="sd">        Yields:</span>
<span class="sd">            tuple: Generator for (role, resources).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Retrieving access to resources for a given member,&#39;</span>
                     <span class="s1">&#39; model_name = </span><span class="si">%s</span><span class="s1">, member_name = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; permission_names = </span><span class="si">%s</span><span class="s1">, expand_resources = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span>
                     <span class="n">permission_names</span><span class="p">,</span> <span class="n">expand_resources</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">role</span><span class="p">,</span> <span class="n">resources</span> <span class="ow">in</span> <span class="n">data_access</span><span class="o">.</span><span class="n">query_access_by_member</span><span class="p">(</span>
                    <span class="n">session</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">permission_names</span><span class="p">,</span> <span class="n">expand_resources</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">role</span><span class="p">,</span> <span class="n">resources</span></div>

<div class="viewcode-block" id="Explainer.get_permissions_by_roles"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.services.explain.explainer.html#google.cloud.forseti.services.explain.explainer.Explainer.get_permissions_by_roles">[docs]</a>    <span class="k">def</span> <span class="nf">get_permissions_by_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">role_names</span><span class="p">,</span> <span class="n">role_prefixes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the permissions associated with the specified roles.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str): Model to operate on.</span>
<span class="sd">            role_names (list): Role names to query for.</span>
<span class="sd">            role_prefixes (list): Role name prefixes to query for</span>

<span class="sd">        Yields:</span>
<span class="sd">            tuple: Generator for (Role, Permission).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Retrieving the permissions associated with the&#39;</span>
                     <span class="s1">&#39; specified roles, model_name = </span><span class="si">%s</span><span class="s1">, role_names = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                     <span class="s1">&#39; role_prefixes = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                     <span class="n">model_name</span><span class="p">,</span> <span class="n">role_names</span><span class="p">,</span> <span class="n">role_prefixes</span><span class="p">)</span>
        <span class="n">model_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">model_manager</span>
        <span class="n">scoped_session</span><span class="p">,</span> <span class="n">data_access</span> <span class="o">=</span> <span class="n">model_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">scoped_session</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data_access</span><span class="o">.</span><span class="n">query_permissions_by_roles</span><span class="p">(</span>
                    <span class="n">session</span><span class="p">,</span> <span class="n">role_names</span><span class="p">,</span> <span class="n">role_prefixes</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">result</span></div></div>
</pre></div>
