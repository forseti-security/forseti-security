---
layout: docs

title: "google.cloud.forseti.common.gcp_api.repository_mixins"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.common.gcp_api.repository_mixins</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2017 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Mixin classes for _base_repository.GCPRepository implementations.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">builtins</span> <span class="k">import</span> <span class="nb">object</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="k">import</span> <span class="n">logger</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="ListQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.ListQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">ListQueryMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements paged List query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ListQueryMixin.list"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.ListQueryMixin.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List subresources of a given resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): The id of the resource to query.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            max_results (int): Number of entries to include per page.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the query.</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: An API response containing one page of results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_max_results_field</span><span class="p">:</span> <span class="n">max_results</span><span class="p">}</span>

        <span class="c1"># Most APIs call list on a parent resource to list subresources of</span>
        <span class="c1"># a specific type. For APIs that have no parent, set the list_key_field</span>
        <span class="c1"># to None when initializing the GCPRespository instance.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_key_field</span> <span class="ow">and</span> <span class="n">resource</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_key_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_supports_pagination</span><span class="p">(</span><span class="n">verb</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_paged_query</span><span class="p">(</span><span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
                                                 <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">resp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Some API list() methods are not actually paginated.</span>
            <span class="k">del</span> <span class="n">arguments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_results_field</span><span class="p">]</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span> <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AggregatedListQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.AggregatedListQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">AggregatedListQueryMixin</span><span class="p">(</span><span class="n">ListQueryMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements a paged AggregatedList query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AggregatedListQueryMixin.aggregated_list"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.AggregatedListQueryMixin.aggregated_list">[docs]</a>    <span class="k">def</span> <span class="nf">aggregated_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;aggregatedList&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List all subresource entities of a given resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): The id of the resource to query.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            max_results (int): Number of entries to include per page.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            iterator: An iterator of API responses by page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AggregatedListQueryMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">max_results</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GetQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.GetQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">GetQueryMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements Get query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GetQueryMixin.get"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.GetQueryMixin.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get API entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): The id of the resource to query.</span>
<span class="sd">            target (str):  Name of the entity to fetch.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Response from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When get_key_field was not defined in the base</span>
<span class="sd">                GCPRepository instance.</span>
<span class="sd">            errors.HttpError: When attempting to get a non-existent entity.</span>
<span class="sd">               ex: HttpError 404 when requesting ... returned</span>
<span class="sd">                   &quot;The resource &#39;...&#39; was not found&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Repository was created without a valid &#39;</span>
                             <span class="s1">&#39;get_key_field argument. Cannot execute get &#39;</span>
                             <span class="s1">&#39;request.&#39;</span><span class="p">)</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
                     <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">}</span>

        <span class="c1"># Most APIs take both a resource and a target when calling get, but</span>
        <span class="c1"># for APIs that the resource itself is the target, then setting</span>
        <span class="c1"># &#39;entity&#39; to None when initializing the GCPRepository instance will</span>
        <span class="c1"># ensure the correct parameters are passed to the API method.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span> <span class="ow">and</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
            <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="GetIamPolicyQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.GetIamPolicyQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">GetIamPolicyQueryMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements getIamPolicy query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GetIamPolicyQueryMixin.get_iam_policy"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.GetIamPolicyQueryMixin.get_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">get_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;getIamPolicy&#39;</span><span class="p">,</span>
                       <span class="n">include_body</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resource_field</span><span class="o">=</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get resource IAM Policy.</span>
<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): The id of the resource to fetch.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            include_body (bool): If true, include an empty body parameter in the</span>
<span class="sd">                method args.</span>
<span class="sd">            resource_field (str): The parameter name of the resource field to</span>
<span class="sd">                pass to the method.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Response from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">            errors.HttpError: When attempting to get a non-existent entity.</span>
<span class="sd">                ex: HttpError 404 when requesting ... returned</span>
<span class="sd">                    &quot;The resource &#39;...&#39; was not found&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="n">resource_field</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
                     <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">include_body</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
            <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="OrgPolicyQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.OrgPolicyQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">OrgPolicyQueryMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements getOrgPolicy and listOrgPolicies query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="OrgPolicyQueryMixin.get_effective_org_policy"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.OrgPolicyQueryMixin.get_effective_org_policy">[docs]</a>    <span class="k">def</span> <span class="nf">get_effective_org_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;getEffectiveOrgPolicy&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get Effective Org Policy for a constraint on a resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): The id of the resource to fetch.</span>
<span class="sd">            constraint (str): The constraint name to fetch the policy for.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Response from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">            errors.HttpError: When attempting to get a non-existent entity.</span>
<span class="sd">                ex: HttpError 404 when requesting ... returned</span>
<span class="sd">                    &quot;The resource &#39;...&#39; was not found&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;resource&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                     <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;constraint&#39;</span><span class="p">:</span> <span class="n">constraint</span><span class="p">}}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
            <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OrgPolicyQueryMixin.get_org_policy"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.OrgPolicyQueryMixin.get_org_policy">[docs]</a>    <span class="k">def</span> <span class="nf">get_org_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">constraint</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;getOrgPolicy&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get Org Policy for a constraint on a resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): The id of the resource to fetch.</span>
<span class="sd">            constraint (str): The constraint name to fetch the policy for.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Response from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">            errors.HttpError: When attempting to get a non-existent entity.</span>
<span class="sd">                ex: HttpError 404 when requesting ... returned</span>
<span class="sd">                    &quot;The resource &#39;...&#39; was not found&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;resource&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
                     <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;constraint&#39;</span><span class="p">:</span> <span class="n">constraint</span><span class="p">}}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
            <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OrgPolicyQueryMixin.list_org_policies"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.OrgPolicyQueryMixin.list_org_policies">[docs]</a>    <span class="k">def</span> <span class="nf">list_org_policies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;listOrgPolicies&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List Org Policies applied to the resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): The id of the resource to query.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            max_results (int): Number of entries to include per page.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the query.</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: An API response containing one page of results.</span>

<span class="sd">        Raises:</span>
<span class="sd">            errors.HttpError: When attempting to get a non-existent entity.</span>
<span class="sd">                ex: HttpError 404 when requesting ... returned</span>
<span class="sd">                    &quot;The resource &#39;...&#39; was not found&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;resource&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">][</span><span class="s1">&#39;pageSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_results</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_search_query</span><span class="p">(</span>
                <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
                <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">resp</span></div></div>


<div class="viewcode-block" id="ExportAssetsQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.ExportAssetsQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">ExportAssetsQueryMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements the exportAssets query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExportAssetsQueryMixin.export_assets"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.ExportAssetsQueryMixin.export_assets">[docs]</a>    <span class="k">def</span> <span class="nf">export_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">output_config</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">asset_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;exportAssets&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export assets under a parent resource to a file on GCS.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (str): The name of the parent resource to export assests</span>
<span class="sd">                under.</span>
<span class="sd">            output_config (dict): The full outputConfig message to pass to the</span>
<span class="sd">                export assets API.</span>
<span class="sd">                https://cloud.google.com/resource-manager/docs/cloud-asset-inventory/reference/rest/v1/TopLevel/exportAssets#OutputConfig</span>
<span class="sd">            content_type (str): The specific content type to export, currently</span>
<span class="sd">                supports &quot;RESOURCE&quot; and &quot;IAM_POLICY&quot;. If not specified only the</span>
<span class="sd">                CAI metadata for assets are included.</span>
<span class="sd">            asset_types (list): The list of asset types to filter the results</span>
<span class="sd">                to, if not specified, exports all assets known to CAI.</span>
<span class="sd">            read_time (str): A timestamp to take an asset snapshot in RFC3339</span>
<span class="sd">                UTC &quot;Zulu&quot; format, accurate to nanoseconds.</span>
<span class="sd">                Example: &quot;2014-10-02T15:01:23.045123456Z&quot;</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Additional parameters to pass to the API method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The response from the API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;outputConfig&#39;</span><span class="p">:</span> <span class="n">output_config</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">content_type</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s1">&#39;contentType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_type</span>

        <span class="k">if</span> <span class="n">asset_types</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s1">&#39;assetTypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">asset_types</span>

        <span class="k">if</span> <span class="n">read_time</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s1">&#39;readTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_time</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">body</span><span class="p">,</span>
            <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
            <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="SearchQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.SearchQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">SearchQueryMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements a paged Search query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="SearchQueryMixin.search"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.SearchQueryMixin.search">[docs]</a>    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List all subresource entities visable to the caller.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            query (str): Additional filters to apply to the restrict the</span>
<span class="sd">                set of resources returned.</span>
<span class="sd">            fields (str): Fields to include in the response - partial response.</span>
<span class="sd">            max_results (int): Number of entries to include per page.</span>
<span class="sd">            verb (str): The method to call on the API.</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict: An API response containing one page of results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req_body</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">req_body</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_query_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span>

        <span class="n">req_body</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_results_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_results</span>

        <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_search_query</span><span class="p">(</span>
                <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span>
                <span class="n">verb_arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">req_body</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="p">}):</span>
            <span class="k">yield</span> <span class="n">resp</span></div></div>


<div class="viewcode-block" id="CreateQueryMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.CreateQueryMixin">[docs]</a><span class="k">class</span> <span class="nc">CreateQueryMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements a Create query.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CreateQueryMixin.create"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.CreateQueryMixin.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to create.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: An API response containing one page of results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">):</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span> <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="InsertResourceMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.InsertResourceMixin">[docs]</a><span class="k">class</span> <span class="nc">InsertResourceMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements the Insert API command for resources.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InsertResourceMixin.insert"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.InsertResourceMixin.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;insert&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert a new resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): Name of the parent resource to insert the resource</span>
<span class="sd">                under.</span>
<span class="sd">            data (dict): The json representation of the resource to add.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the api.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The API response containing the async operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When get_key_field was not defined in the base</span>
<span class="sd">                GCPRepository instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Repository was created without a valid &#39;</span>
                             <span class="s1">&#39;key_field argument. Cannot execute insert &#39;</span>
                             <span class="s1">&#39;request.&#39;</span><span class="p">)</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Insert called on a read only repository, no action taken on &#39;</span>
                <span class="s1">&#39;resource </span><span class="si">%s</span><span class="s1"> for data </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span> <span class="ow">and</span> <span class="n">target</span><span class="p">:</span>
                <span class="n">arguments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
            <span class="n">resource_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_resource_link</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_create_fake_operation</span><span class="p">(</span><span class="n">resource_link</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span> <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="_ModifyResourceBaseMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins._ModifyResourceBaseMixin">[docs]</a><span class="k">class</span> <span class="nc">_ModifyResourceBaseMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for Patch and Update Mixins.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="_ModifyResourceBaseMixin._modify_resource"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins._ModifyResourceBaseMixin._modify_resource">[docs]</a>    <span class="k">def</span> <span class="nf">_modify_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Patch or update an existing resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): Name of the parent resource to modify the resource</span>
<span class="sd">                under.</span>
<span class="sd">            data (dict): The json representation of the resource to modify, this</span>
<span class="sd">                will update the existing resource.</span>
<span class="sd">            target (str): Name of the entity to modify.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the api.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The API response containing the async operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When get_key_field was not defined in the base</span>
<span class="sd">                GCPRepository instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Repository was created without a valid &#39;</span>
                             <span class="s1">&#39;key_field argument. Cannot execute update &#39;</span>
                             <span class="s1">&#39;request.&#39;</span><span class="p">)</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Most APIs take both a resource and a target when calling update, but</span>
        <span class="c1"># for APIs that the resource itself is the target, then setting</span>
        <span class="c1"># &#39;entity&#39; to None when initializing the GCPRepository instance will</span>
        <span class="c1"># ensure the correct parameters are passed to the API method.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span> <span class="ow">and</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> called on a read only repository, no action taken on &#39;</span>
                <span class="s1">&#39;target </span><span class="si">%s</span><span class="s1">, resource </span><span class="si">%s</span><span class="s1"> for data </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span>
                <span class="n">data</span><span class="p">)</span>
            <span class="n">resource_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_resource_link</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_create_fake_operation</span><span class="p">(</span><span class="n">resource_link</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span> <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PatchResourceMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.PatchResourceMixin">[docs]</a><span class="k">class</span> <span class="nc">PatchResourceMixin</span><span class="p">(</span><span class="n">_ModifyResourceBaseMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements the Patch API command for resources.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PatchResourceMixin.patch"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.PatchResourceMixin.patch">[docs]</a>    <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Patch an existing resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): Name of the parent resource to patch the resource</span>
<span class="sd">                under.</span>
<span class="sd">            data (dict): The json representation of the resource to patch, this</span>
<span class="sd">                will update the existing resource.</span>
<span class="sd">            target (str): Name of the entity to patch.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the api.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The API response containing the async operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When get_key_field was not defined in the base</span>
<span class="sd">                GCPRepository instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modify_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="UpdateResourceMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.UpdateResourceMixin">[docs]</a><span class="k">class</span> <span class="nc">UpdateResourceMixin</span><span class="p">(</span><span class="n">_ModifyResourceBaseMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements the Update API command for resources.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UpdateResourceMixin.update"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.UpdateResourceMixin.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update an existing resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): Name of the parent resource to update the resource</span>
<span class="sd">                under.</span>
<span class="sd">            data (dict): The json representation of the resource to update, this</span>
<span class="sd">                will replace the existing resource.</span>
<span class="sd">            target (str): Name of the entity to update.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the api.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The API response containing the async operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When get_key_field was not defined in the base</span>
<span class="sd">                GCPRepository instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modify_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DeleteResourceMixin"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.DeleteResourceMixin">[docs]</a><span class="k">class</span> <span class="nc">DeleteResourceMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mixin that implements the Delete API command for resources.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DeleteResourceMixin.delete"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins.DeleteResourceMixin.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete an existing resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (GCPRespository): An instance of a GCPRespository class.</span>
<span class="sd">            resource (str): Name of the parent resource to delete the resource</span>
<span class="sd">                under.</span>
<span class="sd">            target (str): Name of the entity to delete.</span>
<span class="sd">            verb (str): The method to call on the API.</span>
<span class="sd">            **kwargs (dict): Optional additional arguments to pass to the api.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The API response containing the async operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When get_key_field was not defined in the base</span>
<span class="sd">                GCPRepository instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Repository was created without a valid &#39;</span>
                             <span class="s1">&#39;key_field argument. Cannot execute delete &#39;</span>
                             <span class="s1">&#39;request.&#39;</span><span class="p">)</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_key_field</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Most APIs take both a resource and a target when calling delete, but</span>
        <span class="c1"># for APIs that the resource itself is the target, then setting</span>
        <span class="c1"># &#39;entity&#39; to None when initializing the GCPRepository instance will</span>
        <span class="c1"># ensure the correct parameters are passed to the API method.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span> <span class="ow">and</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">arguments</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_only</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Delete called on a read only repository, no action taken on &#39;</span>
                <span class="s1">&#39;target </span><span class="si">%s</span><span class="s1"> under resource </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
            <span class="n">resource_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_resource_link</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_create_fake_operation</span><span class="p">(</span><span class="n">resource_link</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span> <span class="n">verb_arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="_create_fake_operation"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.repository_mixins.html#google.cloud.forseti.common.gcp_api.repository_mixins._create_fake_operation">[docs]</a><span class="k">def</span> <span class="nf">_create_fake_operation</span><span class="p">(</span><span class="n">resource_link</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a fake operation resource dictionary for dry run.</span>

<span class="sd">    Args:</span>
<span class="sd">        resource_link (str): The full URL to the resource the operation would</span>
<span class="sd">            have modified.</span>
<span class="sd">        verb (str): The API method the operation would have been for.</span>
<span class="sd">        name (str): The operation name, can be any string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A fake Operation resource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;targetLink&#39;</span><span class="p">:</span> <span class="n">resource_link</span><span class="p">,</span>
        <span class="s1">&#39;operationType&#39;</span><span class="p">:</span> <span class="n">verb</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;DONE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;progress&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">}</span></div>
</pre></div>
