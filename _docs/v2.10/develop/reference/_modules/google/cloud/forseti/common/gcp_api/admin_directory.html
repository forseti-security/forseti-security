---
layout: docs

title: "google.cloud.forseti.common.gcp_api.admin_directory"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.common.gcp_api.admin_directory</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2017 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Wrapper for Admin Directory  API client.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">googleapiclient</span> <span class="k">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">httplib2</span> <span class="k">import</span> <span class="n">HttpLib2Error</span>
<span class="kn">from</span> <span class="nn">google.auth.exceptions</span> <span class="k">import</span> <span class="n">RefreshError</span>

<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">_base_repository</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">api_helpers</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">errors</span> <span class="k">as</span> <span class="n">api_errors</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">repository_mixins</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="k">import</span> <span class="n">logger</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">API_NAME</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>

<span class="n">REQUIRED_SCOPES</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span>
    <span class="s1">&#39;https://www.googleapis.com/auth/admin.directory.group.readonly&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://www.googleapis.com/auth/admin.directory.user.readonly&#39;</span>
<span class="p">])</span>

<span class="n">GSUITE_AUTH_FAILURE_MESSAGE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;Failed to retrieve G Suite data due to authentication &#39;</span>
    <span class="s1">&#39;failure. Please make sure your forseti_server_config.yaml &#39;</span>
    <span class="s1">&#39;file contains the most updated information and enable G &#39;</span>
    <span class="s1">&#39;Suite Groups Collection if you haven</span><span class="se">\&#39;</span><span class="s1">t done so. Instructions&#39;</span>
    <span class="s1">&#39; on how to enable: https://forsetisecurity.org/docs/v2.10/&#39;</span>
    <span class="s1">&#39;configure/inventory/gsuite.html&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="AdminDirectoryRepositoryClient"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory.AdminDirectoryRepositoryClient">[docs]</a><span class="k">class</span> <span class="nc">AdminDirectoryRepositoryClient</span><span class="p">(</span><span class="n">_base_repository</span><span class="o">.</span><span class="n">BaseRepositoryClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Admin Directory API Respository Client.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">credentials</span><span class="p">,</span>
                 <span class="n">quota_max_calls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">quota_period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">use_rate_limiter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (object): An google.auth credentials object. The admin</span>
<span class="sd">                directory API needs a service account credential with delegated</span>
<span class="sd">                super admin role.</span>
<span class="sd">            quota_max_calls (int): Allowed requests per &lt;quota_period&gt; for the</span>
<span class="sd">                API.</span>
<span class="sd">            quota_period (float): The time period to track requests over.</span>
<span class="sd">            use_rate_limiter (bool): Set to false to disable the use of a rate</span>
<span class="sd">                limiter for this service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quota_max_calls</span><span class="p">:</span>
            <span class="n">use_rate_limiter</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_members</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_users</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AdminDirectoryRepositoryClient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">API_NAME</span><span class="p">,</span> <span class="n">versions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;directory_v1&#39;</span><span class="p">],</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
            <span class="n">quota_max_calls</span><span class="o">=</span><span class="n">quota_max_calls</span><span class="p">,</span>
            <span class="n">quota_period</span><span class="o">=</span><span class="n">quota_period</span><span class="p">,</span>
            <span class="n">use_rate_limiter</span><span class="o">=</span><span class="n">use_rate_limiter</span><span class="p">)</span>

    <span class="c1"># Turn off docstrings for properties.</span>
    <span class="c1"># pylint: disable=missing-return-doc, missing-return-type-doc</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an _AdminDirectoryGroupsRepository instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_repository</span><span class="p">(</span>
                <span class="n">_AdminDirectoryGroupsRepository</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an _AdminDirectoryMembersRepository instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_members</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_repository</span><span class="p">(</span>
                <span class="n">_AdminDirectoryMembersRepository</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_members</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an _AdminDirectoryUsersRepository instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_users</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_repository</span><span class="p">(</span>
                <span class="n">_AdminDirectoryUsersRepository</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_users</span></div>
    <span class="c1"># pylint: enable=missing-return-doc, missing-return-type-doc</span>


<div class="viewcode-block" id="_AdminDirectoryGroupsRepository"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory._AdminDirectoryGroupsRepository">[docs]</a><span class="k">class</span> <span class="nc">_AdminDirectoryGroupsRepository</span><span class="p">(</span>
        <span class="n">repository_mixins</span><span class="o">.</span><span class="n">ListQueryMixin</span><span class="p">,</span>
        <span class="n">_base_repository</span><span class="o">.</span><span class="n">GCPRepository</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implementation of Admin Directory Groups repository.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (dict): The args to pass into GCPRepository.__init__()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_AdminDirectoryGroupsRepository</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">key_field</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="_AdminDirectoryMembersRepository"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory._AdminDirectoryMembersRepository">[docs]</a><span class="k">class</span> <span class="nc">_AdminDirectoryMembersRepository</span><span class="p">(</span>
        <span class="n">repository_mixins</span><span class="o">.</span><span class="n">ListQueryMixin</span><span class="p">,</span>
        <span class="n">_base_repository</span><span class="o">.</span><span class="n">GCPRepository</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implementation of Admin Directory Members repository.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (dict): The args to pass into GCPRepository.__init__()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_AdminDirectoryMembersRepository</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">key_field</span><span class="o">=</span><span class="s1">&#39;groupKey&#39;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s1">&#39;members&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="_AdminDirectoryUsersRepository"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory._AdminDirectoryUsersRepository">[docs]</a><span class="k">class</span> <span class="nc">_AdminDirectoryUsersRepository</span><span class="p">(</span>
        <span class="n">repository_mixins</span><span class="o">.</span><span class="n">ListQueryMixin</span><span class="p">,</span>
        <span class="n">_base_repository</span><span class="o">.</span><span class="n">GCPRepository</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implementation of Admin Directory Users repository.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (dict): The args to pass into GCPRepository.__init__()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_AdminDirectoryUsersRepository</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">key_field</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="AdminDirectoryClient"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory.AdminDirectoryClient">[docs]</a><span class="k">class</span> <span class="nc">AdminDirectoryClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;GSuite Admin Directory API Client.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_configs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Args:</span>
<span class="sd">            global_configs (dict): Global configurations.</span>
<span class="sd">            **kwargs (dict): The kwargs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">api_helpers</span><span class="o">.</span><span class="n">get_delegated_credential</span><span class="p">(</span>
            <span class="n">global_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;domain_super_admin_email&#39;</span><span class="p">),</span>
            <span class="n">REQUIRED_SCOPES</span><span class="p">)</span>

        <span class="n">max_calls</span><span class="p">,</span> <span class="n">quota_period</span> <span class="o">=</span> <span class="n">api_helpers</span><span class="o">.</span><span class="n">get_ratelimiter_config</span><span class="p">(</span>
            <span class="n">global_configs</span><span class="p">,</span> <span class="n">API_NAME</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">repository</span> <span class="o">=</span> <span class="n">AdminDirectoryRepositoryClient</span><span class="p">(</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
            <span class="n">quota_max_calls</span><span class="o">=</span><span class="n">max_calls</span><span class="p">,</span>
            <span class="n">quota_period</span><span class="o">=</span><span class="n">quota_period</span><span class="p">,</span>
            <span class="n">use_rate_limiter</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_rate_limiter&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

<div class="viewcode-block" id="AdminDirectoryClient.get_group_members"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory.AdminDirectoryClient.get_group_members">[docs]</a>    <span class="k">def</span> <span class="nf">get_group_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all the members for specified groups.</span>

<span class="sd">        Args:</span>
<span class="sd">            group_key (str): The group&#39;s unique id assigned by the Admin API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of member objects from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">            api_errors.ApiExecutionError: If group member retrieval fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paged_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">group_key</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">api_helpers</span><span class="o">.</span><span class="n">flatten_list_results</span><span class="p">(</span><span class="n">paged_results</span><span class="p">,</span> <span class="s1">&#39;members&#39;</span><span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Getting all the members for group_key = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                         <span class="s1">&#39; result = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">group_key</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HttpError</span><span class="p">,</span> <span class="n">HttpLib2Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">api_errors</span><span class="o">.</span><span class="n">ApiExecutionError</span><span class="p">(</span><span class="n">group_key</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdminDirectoryClient.get_groups"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory.AdminDirectoryClient.get_groups">[docs]</a>    <span class="k">def</span> <span class="nf">get_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="o">=</span><span class="s1">&#39;my_customer&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all the groups for a given customer_id.</span>

<span class="sd">        A note on customer_id=&#39;my_customer&#39;. This is a magic string instead</span>
<span class="sd">        of using the real customer id. See:</span>

<span class="sd">        https://developers.google.com/admin-sdk/directory/v1/guides/manage-groups#get_all_domain_groups</span>

<span class="sd">        Args:</span>
<span class="sd">            customer_id (str): The customer id to scope the request to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of group objects returned from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">            api_errors.ApiExecutionError: If groups retrieval fails.</span>
<span class="sd">            RefreshError: If the authentication fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paged_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="n">customer_id</span><span class="p">)</span>
            <span class="n">flattened_results</span> <span class="o">=</span> <span class="n">api_helpers</span><span class="o">.</span><span class="n">flatten_list_results</span><span class="p">(</span>
                <span class="n">paged_results</span><span class="p">,</span> <span class="s1">&#39;groups&#39;</span><span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Getting all the groups for customer_id = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                         <span class="s1">&#39; flattened_results = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                         <span class="n">customer_id</span><span class="p">,</span> <span class="n">flattened_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">flattened_results</span>
        <span class="k">except</span> <span class="n">RefreshError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Authentication failed, log before raise.</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">GSUITE_AUTH_FAILURE_MESSAGE</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HttpError</span><span class="p">,</span> <span class="n">HttpLib2Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">api_errors</span><span class="o">.</span><span class="n">ApiExecutionError</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="AdminDirectoryClient.get_users"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.admin_directory.html#google.cloud.forseti.common.gcp_api.admin_directory.AdminDirectoryClient.get_users">[docs]</a>    <span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="o">=</span><span class="s1">&#39;my_customer&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all the users for a given customer_id.</span>

<span class="sd">        A note on customer_id=&#39;my_customer&#39;. This is a magic string instead</span>
<span class="sd">        of using the real customer id. See:</span>

<span class="sd">        https://developers.google.com/admin-sdk/directory/v1/guides/manage-groups#get_all_domain_groups</span>

<span class="sd">        Args:</span>
<span class="sd">            customer_id (str): The customer id to scope the request to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of user objects returned from the API.</span>

<span class="sd">        Raises:</span>
<span class="sd">            api_errors.ApiExecutionError: If groups retrieval fails.</span>
<span class="sd">            RefreshError: If the authentication fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paged_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="n">customer_id</span><span class="p">,</span>
                                                       <span class="n">viewType</span><span class="o">=</span><span class="s1">&#39;admin_view&#39;</span><span class="p">)</span>
            <span class="n">flattened_results</span> <span class="o">=</span> <span class="n">api_helpers</span><span class="o">.</span><span class="n">flatten_list_results</span><span class="p">(</span>
                <span class="n">paged_results</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Getting all the users for customer_id = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                         <span class="s1">&#39; flattened_results = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                         <span class="n">customer_id</span><span class="p">,</span> <span class="n">flattened_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">flattened_results</span>
        <span class="k">except</span> <span class="n">RefreshError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Authentication failed, log before raise.</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">GSUITE_AUTH_FAILURE_MESSAGE</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HttpError</span><span class="p">,</span> <span class="n">HttpLib2Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">api_errors</span><span class="o">.</span><span class="n">ApiExecutionError</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div></div>
</pre></div>
