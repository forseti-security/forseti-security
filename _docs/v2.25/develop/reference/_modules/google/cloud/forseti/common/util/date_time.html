---
layout: docs

title: "google.cloud.forseti.common.util.date_time"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.common.util.date_time</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2017 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Common utility functions regarding date and time.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>

<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="kn">import</span> <span class="n">string_formats</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Base UtilDateTime Exception.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="DateTimeValueConversionError"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.DateTimeValueConversionError">[docs]</a><span class="k">class</span> <span class="nc">DateTimeValueConversionError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Invalid Value Given for a Request.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="DateTimeTypeConversionError"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.DateTimeTypeConversionError">[docs]</a><span class="k">class</span> <span class="nc">DateTimeTypeConversionError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Type Error for a given Request.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="get_datetime_from_string"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_datetime_from_string">[docs]</a><span class="k">def</span> <span class="nf">get_datetime_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">string_format</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a datetime object from a string in the requested string_format.</span>

<span class="sd">        Args:</span>
<span class="sd">            string (str): The timestamp in the form of a string.</span>
<span class="sd">            string_format (str): A string used for formatting.</span>

<span class="sd">        Raises:</span>
<span class="sd">           DateTimeTypeConversionError: When datetime.strptime() raises a</span>
<span class="sd">              TypeError.</span>
<span class="sd">           DateTimeValueConversionError: When datetime.strptime() raises a</span>
<span class="sd">              ValueError.</span>

<span class="sd">        Returns:</span>
<span class="sd">            datetime: A datetime object as requested.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">string_format</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Unable to create a datetime with </span><span class="si">%s</span><span class="s1"> in &#39;</span>
                         <span class="s1">&#39;format </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">string_format</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">DateTimeTypeConversionError</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Unable to create a datetime with </span><span class="si">%s</span><span class="s1"> in &#39;</span>
                         <span class="s1">&#39;format </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">string_format</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">DateTimeValueConversionError</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="get_unix_timestamp_from_string"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_unix_timestamp_from_string">[docs]</a><span class="k">def</span> <span class="nf">get_unix_timestamp_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse string to a unix timestamp, as seconds since epoch.</span>

<span class="sd">    Args:</span>
<span class="sd">        string (str): The time string to parse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The timestamp in seconds.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Raised for unknown string formats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">())</span></div>


<div class="viewcode-block" id="get_utc_now_datetime"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_utc_now_datetime">[docs]</a><span class="k">def</span> <span class="nf">get_utc_now_datetime</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get a datetime object for utcnow()</span>

<span class="sd">    Returns:</span>
<span class="sd">          datetime: A datetime object representing utcnow().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_utc_now_timestamp_human"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_utc_now_timestamp_human">[docs]</a><span class="k">def</span> <span class="nf">get_utc_now_timestamp_human</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a human formatted str representing utcnow()</span>

<span class="sd">    Args:</span>
<span class="sd">        date (datetime): A datetime object representing current time in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">          str: A timestamp in the classes default timestamp format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">utc_now</span> <span class="o">=</span> <span class="n">date</span> <span class="ow">or</span> <span class="n">get_utc_now_datetime</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">utc_now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">string_formats</span><span class="o">.</span><span class="n">DEFAULT_FORSETI_HUMAN_TIMESTAMP</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_utc_now_timestamp"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_utc_now_timestamp">[docs]</a><span class="k">def</span> <span class="nf">get_utc_now_timestamp</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a formatted str representing utcnow()</span>

<span class="sd">    Args:</span>
<span class="sd">        date (datetime): A datetime object representing current time in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">          str: A timestamp in the classes default timestamp format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">utc_now</span> <span class="o">=</span> <span class="n">date</span> <span class="ow">or</span> <span class="n">get_utc_now_datetime</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">utc_now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">string_formats</span><span class="o">.</span><span class="n">DEFAULT_FORSETI_TIMESTAMP</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_utc_now_unix_timestamp"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_utc_now_unix_timestamp">[docs]</a><span class="k">def</span> <span class="nf">get_utc_now_unix_timestamp</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a 64bit int representing the current time to the millisecond.</span>

<span class="sd">    Args:</span>
<span class="sd">        date (datetime): A datetime object representing current time in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: A epoch timestamp including microseconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">utc_now</span> <span class="o">=</span> <span class="n">date</span> <span class="ow">or</span> <span class="n">get_utc_now_datetime</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">utc_now</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">())</span></div>


<div class="viewcode-block" id="get_utc_now_microtimestamp"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_utc_now_microtimestamp">[docs]</a><span class="k">def</span> <span class="nf">get_utc_now_microtimestamp</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a 64bit int representing the current time to the millisecond.</span>

<span class="sd">    Args:</span>
<span class="sd">        date (datetime): A datetime object representing current time in UTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: A epoch timestamp including microseconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">utc_now</span> <span class="o">=</span> <span class="n">date</span> <span class="ow">or</span> <span class="n">get_utc_now_datetime</span><span class="p">()</span>
    <span class="n">micros</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">utc_now</span><span class="o">.</span><span class="n">utctimetuple</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000000</span>
    <span class="k">return</span> <span class="n">micros</span> <span class="o">+</span> <span class="n">utc_now</span><span class="o">.</span><span class="n">microsecond</span></div>


<div class="viewcode-block" id="get_date_from_microtimestamp"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.util.date_time.html#google.cloud.forseti.common.util.date_time.get_date_from_microtimestamp">[docs]</a><span class="k">def</span> <span class="nf">get_date_from_microtimestamp</span><span class="p">(</span><span class="n">microtimestamp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get a datetime object from a 64bit timestamp.</span>

<span class="sd">    Args:</span>
<span class="sd">        microtimestamp (int): A timestamp to be converted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        datetime: The converted datetime object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">microtimestamp</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mf">1000000.0</span><span class="p">))</span></div>
</pre></div>
