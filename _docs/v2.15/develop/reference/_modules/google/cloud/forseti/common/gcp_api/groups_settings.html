---
layout: docs

title: "google.cloud.forseti.common.gcp_api.groups_settings"



hide:
  right_sidebar: true
---
<h1>Source code for google.cloud.forseti.common.gcp_api.groups_settings</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2017 The Forseti Security Authors. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Wrapper for Groups Settings  API client.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">googleapiclient</span> <span class="k">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">httplib2</span> <span class="k">import</span> <span class="n">HttpLib2Error</span>
<span class="kn">from</span> <span class="nn">google.auth.exceptions</span> <span class="k">import</span> <span class="n">RefreshError</span>

<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">_base_repository</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">api_helpers</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">errors</span> <span class="k">as</span> <span class="n">api_errors</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.gcp_api</span> <span class="k">import</span> <span class="n">repository_mixins</span>
<span class="kn">from</span> <span class="nn">google.cloud.forseti.common.util</span> <span class="k">import</span> <span class="n">logger</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">API_NAME</span> <span class="o">=</span> <span class="s1">&#39;groupssettings&#39;</span>

<span class="n">REQUIRED_SCOPES</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span>
    <span class="s1">&#39;https://www.googleapis.com/auth/apps.groups.settings&#39;</span>
<span class="p">])</span>

<span class="n">GSUITE_AUTH_FAILURE_MESSAGE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;Failed to retrieve G Suite Group Settings data due to authentication &#39;</span>
    <span class="s1">&#39;failure. Please make sure your forseti_server_config.yaml &#39;</span>
    <span class="s1">&#39;file contains the most updated information and enable G &#39;</span>
    <span class="s1">&#39;Suite Groups Collection if you haven</span><span class="se">\&#39;</span><span class="s1">t done so. Instructions&#39;</span>
    <span class="s1">&#39;on how to enable: https://forsetisecurity.org/docs/v2.15/&#39;</span>
    <span class="s1">&#39;configure/inventory/gsuite.html&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="GroupsSettingsRepositoryClient"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.groups_settings.html#google.cloud.forseti.common.gcp_api.groups_settings.GroupsSettingsRepositoryClient">[docs]</a><span class="k">class</span> <span class="nc">GroupsSettingsRepositoryClient</span><span class="p">(</span><span class="n">_base_repository</span><span class="o">.</span><span class="n">BaseRepositoryClient</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Groups Settings API Respository Client.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">credentials</span><span class="p">,</span>
                 <span class="n">quota_max_calls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">quota_period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">use_rate_limiter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            credentials (object): An google.auth credentials object. The group</span>
<span class="sd">                settings API needs a service account credential with delegated</span>
<span class="sd">                super admin role.</span>
<span class="sd">            quota_max_calls (int): Allowed requests per &lt;quota_period&gt; for the</span>
<span class="sd">                API.</span>
<span class="sd">            quota_period (float): The time period to track requests over.</span>
<span class="sd">            use_rate_limiter (bool): Set to false to disable the use of a rate</span>
<span class="sd">                limiter for this service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quota_max_calls</span><span class="p">:</span>
            <span class="n">use_rate_limiter</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GroupsSettingsRepositoryClient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">API_NAME</span><span class="p">,</span> <span class="n">versions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">],</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
            <span class="n">quota_max_calls</span><span class="o">=</span><span class="n">quota_max_calls</span><span class="p">,</span>
            <span class="n">quota_period</span><span class="o">=</span><span class="n">quota_period</span><span class="p">,</span>
            <span class="n">use_rate_limiter</span><span class="o">=</span><span class="n">use_rate_limiter</span><span class="p">)</span>

    <span class="c1"># Turn off docstrings for properties.</span>
    <span class="c1"># pylint: disable=missing-return-doc, missing-return-type-doc</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a _GroupsSettingsGroupsRepository instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_repository</span><span class="p">(</span>
                <span class="n">_GroupsSettingsGroupsRepository</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span></div>
    <span class="c1"># pylint: enable=missing-return-doc, missing-return-type-doc</span>


<div class="viewcode-block" id="_GroupsSettingsGroupsRepository"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.groups_settings.html#google.cloud.forseti.common.gcp_api.groups_settings._GroupsSettingsGroupsRepository">[docs]</a><span class="k">class</span> <span class="nc">_GroupsSettingsGroupsRepository</span><span class="p">(</span>
        <span class="n">repository_mixins</span><span class="o">.</span><span class="n">GetQueryMixin</span><span class="p">,</span>
        <span class="n">_base_repository</span><span class="o">.</span><span class="n">GCPRepository</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implementation of Groups Settings repository.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs (dict): The args to pass into GCPRepository.__init__()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_GroupsSettingsGroupsRepository</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">key_field</span><span class="o">=</span><span class="s1">&#39;groupUniqueId&#39;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GroupsSettingsClient"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.groups_settings.html#google.cloud.forseti.common.gcp_api.groups_settings.GroupsSettingsClient">[docs]</a><span class="k">class</span> <span class="nc">GroupsSettingsClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;GSuite Groups Settings API Client.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_configs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.</span>

<span class="sd">        Args:</span>
<span class="sd">            global_configs (dict): Global configurations.</span>
<span class="sd">            **kwargs (dict): The kwargs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">api_helpers</span><span class="o">.</span><span class="n">get_delegated_credential</span><span class="p">(</span>
            <span class="n">global_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;domain_super_admin_email&#39;</span><span class="p">),</span>
            <span class="n">REQUIRED_SCOPES</span><span class="p">)</span>

        <span class="n">max_calls</span><span class="p">,</span> <span class="n">quota_period</span> <span class="o">=</span> <span class="n">api_helpers</span><span class="o">.</span><span class="n">get_ratelimiter_config</span><span class="p">(</span>
            <span class="n">global_configs</span><span class="p">,</span> <span class="n">API_NAME</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">repository</span> <span class="o">=</span> <span class="n">GroupsSettingsRepositoryClient</span><span class="p">(</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
            <span class="n">quota_max_calls</span><span class="o">=</span><span class="n">max_calls</span><span class="p">,</span>
            <span class="n">quota_period</span><span class="o">=</span><span class="n">quota_period</span><span class="p">,</span>
            <span class="n">use_rate_limiter</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_rate_limiter&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

<div class="viewcode-block" id="GroupsSettingsClient.get_groups_settings"><a class="viewcode-back" href="../../../../../../google.cloud.forseti.common.gcp_api.groups_settings.html#google.cloud.forseti.common.gcp_api.groups_settings.GroupsSettingsClient.get_groups_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_groups_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_email</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the group settings for a given group.</span>


<span class="sd">        https://developers.google.com/admin-sdk/groups-settings/v1/reference/groups/get</span>

<span class="sd">        Args:</span>
<span class="sd">            group_email (str): The gsuite group email to scope the request to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict:group settings for given group_email.</span>

<span class="sd">        Raises:</span>
<span class="sd">            api_errors.ApiExecutionError: If groups retrieval fails.</span>
<span class="sd">            RefreshError: If the authentication fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_email</span><span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Getting group settings information for group id = </span><span class="si">%s</span><span class="s1">,&#39;</span>
                         <span class="s1">&#39; result = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                         <span class="n">group_email</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="n">RefreshError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Authentication failed, log before raise.</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">GSUITE_AUTH_FAILURE_MESSAGE</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">HttpError</span><span class="p">,</span> <span class="n">HttpLib2Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">api_errors</span><span class="o">.</span><span class="n">ApiExecutionError</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div></div>
</pre></div>
